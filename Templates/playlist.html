<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Musi2Spotify</title>
	<style>
		.flex-container {
			display: flex;
			flex-direction: row;
			flex-wrap: nowrap;
		}
	</style>
    <script>	
        function fetchLiveData() {
			fetch("/get_live_info").then(response => response.json()).then(data => {
					document.getElementById("playlistName").innerHTML = "Loading playlist: "+data.name;
					if (data.scraped!=data.songs){
						document.getElementById("scraped").innerHTML=data.scraped+"/"+data.songs+" songs loaded from playlist"
						document.getElementById("matched").innerHTML=""
					}
					else{
						document.getElementById("scraped").innerHTML="Musi playlist loaded"
						document.getElementById("matched").innerHTML="Finished searching for "+data.matched+"/"+data.songs+" songs on spotify"
					}
					
					let notFoundTableBody = document.getElementById('notFoundTableBody');
					notFoundTableBody.innerHTML = ''; // Clear existing rows
					data.not_found.forEach(song => {
						let row = document.createElement('tr');
	
						let Cell = document.createElement('td');
						let Link = document.createElement("a");
						Link.setAttribute("href", song["url"])
						let LinkText = document.createTextNode(song["title"]+" by "+song["artist"]);
						Link.appendChild(LinkText);
						Cell.appendChild(Link);
	
						row.appendChild(Cell);
	
						notFoundTableBody.appendChild(row);
					});
					
					let foundTableBody = document.getElementById('foundTableBody');
					foundTableBody.innerHTML = ''; // Clear existing rows
	
					data.matches.forEach(match => {
						let row = document.createElement('tr');
	
						let ytCell = document.createElement('td');
						let ytLink = document.createElement("a");
						ytLink.setAttribute("href", match["yt-url"])
						let ytLinkText = document.createTextNode(match["yt-title"]+" by "+match["yt-author"]);
						ytLink.appendChild(ytLinkText);
						ytCell.appendChild(ytLink);
		
						let spCell = document.createElement('td');
						let spLink = document.createElement("a");
						spLink.setAttribute("href", "http://open.spotify.com/track/"+match["sp-id"])
						let spLinkText = document.createTextNode(match["sp-title"]+" by "+match["sp-artist"]);
						spLink.appendChild(spLinkText);
						spCell.appendChild(spLink);
	
						row.appendChild(ytCell);
						row.appendChild(spCell);
	
						foundTableBody.appendChild(row);
					});
					
					if (data.songs!=0 && data.matched==data.songs){
						clearInterval(intervalId);
					}
					else if (!data.loading){
						window.location.replace("/error");
					}
				}
			)
		}
		var intervalId = window.setInterval(function(){
			fetchLiveData()
		}, 1000);
    </script>
</head>
<body>
    <h1>Musi to Spotify playlist converter</h1>

    <h2>waaw</h2>
    <p id="playlistName">Loading playlist: </p>
	<p id="scraped"></p>
	<p id="matched"></p>
	
	<div class="flex-container">
	 <div>
	  <h2>Songs not found on Spotify:  </h2>
	  <div style="overflow-y:auto;max-height: 160px;">
       <table border="1"><thead>
        <tr>
         <td>Youtube Video</td>
        </tr></thead>
	    <tbody id="notFoundTableBody">
	    </tbody>
       </table>
	  </div>
	 </div>
 
 	 <div>
 	  <h2>Songs found on Spotify:</h2>
 	  <div style="overflow-y:auto;max-height: 160px;">
       <table border="1"><thead>
        <tr>
         <td>Youtube Video</td>
         <td>Spotify Track</td>
        </tr></thead>
 	    <tbody id="foundTableBody">
 	    </tbody>
       </table>
 	  </div>
	 </div>
 	</div>

</body>
</html>
